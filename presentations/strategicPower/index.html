<!DOCTYPE html>
<html>
  <head>
    <title>Programming Strategically with the Principle of Least Power</title>
    <meta charset="utf-8">
    <style>
      @import url(https://fonts.googleapis.com/css?family=Yanone+Kaffeesatz);
      @import url(https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic);
      @import url(https://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,400italic);

      body { font-family: 'Droid Serif'; }
      h1, h2, h3 { font-family: 'Yanone Kaffeesatz'; font-weight: normal; }
      .remark-slide-content h1 { font-size: 4em;	}
      .remark-slide-content li { font-size: 2.2em;}
      .remark-slide-content li ul li { font-size: 2.2em;}
      .remark-code, .remark-inline-code { font-family: 'Ubuntu Mono'; }
      .remark-code { font-size: 2.2em; }
      .title {font-size: 3.3em; color:#FFFFFF;font-weight:bold;letter-spacing:0.05em}
      .author {font-size: 2.2em; color:#AAAAAA;font-weight:bold;letter-spacing:0.02em}
      .quote { box-shadow: 0 0 30px #777; padding: 1.5em; font-size: 2.2em; font-style: italic }
      .huge { font-size: 6em; text-align: center }
      .medium { font-size: 4em; text-align: center }
      .footnote { position:absolute; bottom: 1em; left: 1em; font-size: 1em; }
      .koan { color: #AA00AA; -webkit-text-stroke: 2px #000000 }
    </style>
  </head>
  <body>
    <textarea id="source">
class: center, middle
background-color: black
.title[Programming Strategically with the Principle of Least Power]

.author[Leif Wickland]

<img width="60%" src="assets\rubicon-logo.svg">
---
background-image: url("assets/IMG_20160417_170409.jpg")
padding: 0px 0px 0px 0px
background-size: contain;
background-repeat: no-repeat;
background-position: center;
---
# Credit to Li Haoyi

.right[<img src="assets/haoyi.jpg" width=300px; style="float: right; margin: 10px">]
- Strongly inspired by his [blog](http://www.lihaoyi.com/).
- Wicked smart. Scala.js. Amonite.
- Good parts are his.
- Anything stupid is mine.
- Originally he wrote about Scala.
---
class: left, middle
background-image: url(assets/icbm.jpg)
# Strategic<br>Power
---
# Principle of Least Power

.quote[
Given a choice of solutions, pick the least powerful solution capable of solving your problem
]

&mdash; [Li Haoyi](http://www.lihaoyi.com/post/StrategicScalaStylePrincipleofLeastPower.html)
---
# Developers seek power &amp; flexibility

.right[<img src="https://m.popkey.co/5e278e/kdKdw.gif" width=500px; style="float: right; margin: 10px">]

- _My design is so flexible!_
- _I'm not exactly sure how I'm going to do it, so&hellip;_
- _The requirements might change, so&hellip;_
---
# With Great Power

- If it can do anything it _might do anything_
- Bigger possible space to consider
---
# Motivation

.quote[
A restricted solution that &hellip; can only do a few things is straightforward for someone to inspect, analyze and manipulate later.
]

&mdash; [Li Haoyi](http://www.lihaoyi.com/post/StrategicScalaStylePrincipleofLeastPower.html)
---
# Essay

.quote[
transitive verb<br>
to try to do, perform, or deal with
]

## Can the principle of least power be applied to other languages?
---
class: center, middle
<img src="assets/low-hanging-fruit.gif" width="100%">
---
```cs
switch (n) {
  case 1:
    cost += 25; break;
  case 2:
    cost += 25; goto case 1;
  case 3:
    cost += 50; goto case 1;
  default:
    Console.WriteLine("Invalid selection.");
    break;
}
```
From [MSDN `goto` docs](https://msdn.microsoft.com/en-us/library/13940fs2.aspx)
---
.huge[
1968: _Go To Statement Considered Harmful_
]
I promised you details about our languages becoming more powerful in _recent_ years.
---
class: center, middle
.huge[
PHP 5.3 added `goto` in 2009
]
<img src="assets/jawdrop.gif" style="visibility: hidden">
---
class: center, middle
.huge[
PHP 5.3 added `goto` in 2009
]
<img src="assets/jawdrop.gif">
---
```java
Baz baz = null;
while (true) {
  // 20 lines calculating foo
  if (!validate(foo))
    break;
  // 30 lines calculting bar
  if (!validate(bar))
    break;
  // Another 30 lines calculating other values
  baz = new Baz(foo, bar, ...);
  break;
}
return baz;
```
---
```java
Foo foo = calculateFoo();
Bar bar = calculateBar();
// Another few lines calculating other values
if (validate(foo) &&
    validate(bar) &&
    /* validate some other things */) {
  return new Baz(foo, bar, ...);
} else {
  return null;
}
```
---
class: middle, center
.huge[
Immutability changes everything
]
---
```javascript
var label;
if (havingGoodDay(bob)) label = "ok";
else label = "bitter";
```
--
```javascript
// ----- or -----

const label =
  (havingGoodDay(bob)) ?
  "good" :
  "bitter";
```
---
background-image: url("assets/const.png")
padding: 0px 0px 0px 0px
background-size: contain;
background-repeat: no-repeat;
background-position: center;
.footnote[From [caniuse.com](http://caniuse.com/#feat=const)]
---
background-image: url("assets/let.png")
padding: 0px 0px 0px 0px
background-size: contain;
background-repeat: no-repeat;
background-position: center;
.footnote[From [caniuse.com](http://caniuse.com/#feat=let)]
---
```javascript
function tellMeAboutYourFeels() {
  var feels = "meh";
  if (goodDay(bob)) feels = "hawt";
  else if (badDay(bob)) feels = "bitter";
  return feels;
}
```
--
```javascript
// ----- or -----
function tellMeAboutYourFeels() {
  if (goodDay(bob)) return "hawt";
  if (badDay(bob)) return "bitter";
  return "meh";
}
```
---
# Prefer Immutabilty
- As far as possible
- Except if you really need the perf improvement
- Spoiler: Very little of your code does
- Limit the scope of mutabilty
---
background-image: url("assets/doublej.jpg")
padding: 0px 0px 0px 0px
background-size: contain;
background-repeat: no-repeat;
background-position: center;
---
```java
const ImmutableList&lt;String&gt; names = myBffs();
// ----- or -----
ImmutableList&lt;String&gt; names = myBffs();
// ----- or -----
const List&lt;String&gt; names = myBffs();
// ----- or -----
List&lt;String&gt; names = myBffs();
```
<image src="assets/friends.png" width=200px style="float:left; margin: 0 20px 20px 20px;">
--
.medium[
No Double
Mutability]
---
class: center, middle
.medium[
**Thought experiment:**

What's the _least powerful_ way to expose functionality within your project?
]
---
# Haoyi's Hierarchy of Interfaces
- Static method with **standard** types
- Static method with **custom** types
- Class which must be **instantiated** to be called
- Abstract class which must be **subclassed**
---
```scala
def hasCycle[N](nodes: Set[N],
  connectsTo: N => Set[N]): Boolean
```
--
```scala
// ----- or -----

class Node(name: String,
  connectsTo: mutable.Set[Node])

def hasCycle(nodes: Set[Node]): Boolean
```
---
```scala
class Graph {
  def addEdge(from: String, to: String)
  def hasCycle: Boolean
}
```
--
```scala
// ----- or -----

abstract class GraphBase[N] {
  abstract def getNodes: Set[N]
  abstract def connectsTo(node: N): Set[N]
  def hasCycle: Boolean
}
```
---
class: koan
background-image: url(assets/two-monks-blur-16-9.jpg)
--
.footnote[By Anton van Straaten From [MIT CSAIL list](http://people.csail.mit.edu/gregs/ll1-discuss-archive-html/msg03277.html) via [C2](http://c2.com/cgi/wiki?ClosuresAndObjectsAreEquivalent)]
.huge[
The Closure Koan]
???
The venerable master Qc Na was walking with his student, Anton. Hoping to prompt the master into a discussion, Anton said "Master, I have heard that objects are a very good thing - is this true?"
--
.medium[
Objects are good]
???
Qc Na looked pityingly at his student and replied, "Foolish pupil - objects are merely a poor man's closures."
--
.medium[
Poor man's closures]
???
Chastised, Anton took his leave from his master and returned to his cell, intent on studying closures. He carefully read the entire "Lambda: The Ultimate..." series of papers and its cousins, and implemented a small Scheme interpreter with a closure-based object system. He learned much, and looked forward to informing his master of his progress.
--
.medium[
_Lambda: The Ultimate_]
???
On his next walk with Qc Na, Anton attempted to impress his master by saying "Master, I have diligently studied the matter, and now understand that objects are truly a poor man's closures."
--
.medium[
Closures are truly good]
???
Qc Na responded by hitting Anton with his stick, saying "When will you learn? Closures are a poor man's object."
--
.medium[
Poor man's objects]
???
At that moment, Anton became enlightened.
---
# Closures vs Objects
- Both wrap (potentially mutable) state
- Both encapsulate data 
- Both have methods which can be invoked
- Closure only has one method
- You can fake more with stringy dispatch

--
- Please don't
- Closure "constructors" are plausible
---
# For _Less Power_ Pass Closures, not Things
- Generally if a function needs a value, we'll pass that to it
- Often gives the function too much power
- Can mutate the object if it's mutable
- Can access more of object than strictly needed
---
# For _Less Power_ Pass Closures, not Things
- What if instead we pass most restrictive, least powerful thing we can think of: a closure
- Provides a nice abstraction layer without explicitly defining interface
- Receiver can't know any more than closure will tell it
- Shared interface without inheritance
--- 
# For _Less Power_ Pass Closures, not Things
- Please don't take this too far
---
```scala
class Node(name: String,
  connectsTo: mutable.Set[Node])

def hasCycle(nodes: Set[Node]): Boolean

// ----- vs -----

def hasCycle[N](nodes: Set[N],
  connectsTo: N => Set[N]): Boolean

hasCycle(nodes, node => node.connectsTo)
```
---
# Appendix: Orphanage for lost slides
---
# TODO: Keep or drop?
```c
OSStatus err;
// 30 lines of awesome elided
if ((err = SSLHashSHA1.update(...)) != 0)
    goto fail;
if ((err = SSLHashSHA1.update(...)) != 0)
    goto fail;
    goto fail;
// 20 more lines of awesome elided
fail:
return err;
```
from [sslKeyExchange.c](http://opensource.apple.com/source/Security/Security-55471/libsecurity_ssl/lib/sslKeyExchange.c)
---
# Better?
```c
OSStatus err;
// 30 lines of awesome elided
(err = SSLHashSHA1.update(...)) == 0 &&
(err = SSLHashSHA1.update(...)) == 0 &&
// 20 lines more awesome
return err;
```
---
    </textarea>
    <script src="assets/remark-latest-20160606.min.js"> </script>
    <script>
var slideshow = remark.create({
  highlightStyle: "googlecode",
  // Set the slideshow display ratio
  // Default: '4:3'
  // Alternatives: '16:9', ...
  ratio: '16:9',

  // Navigation options
  navigation: {
    // Enable or disable navigating using scroll
    // Default: true
    // Alternatives: false
    scroll: true,

    // Enable or disable navigation using touch
    // Default: true
    // Alternatives: false
    touch: true,

    // Enable or disable navigation using click
    // Default: false
    // Alternatives: true
    click: false
  },

  // .. or by using a format function
  slideNumberFormat: function (current, total) {
    if (current == 1) {
      return '';
    } else {
      return '<img src="assets/rubicon-dots.png" width="100px;"><br>Slide ' + current + ' of ' + total;
    }
  },

  // Enable or disable counting of incremental slides in the slide counting
  countIncrementalSlides: true
});
    </script>
  </body>
</html>
